{% extends "base.html" %}
{% load widget_tweaks %}
{% block title %}Bill for {{ client.name }}{% endblock %}

{% block content %}
    <h2>Bill for {{ client.name }}</h2>
    <div class="mb-3">
        <strong>Bill Date:</strong> {{ bill_date|date:"F d, Y" }}<br>
        <strong>Bill Number:</strong> {{ bill.id }}<br>
        <strong>Bill Type:</strong> 
        {% if is_custom %}
            <span class="badge bg-primary">Custom Bill</span>
        {% else %}
            <span class="badge bg-info">Automated Bill</span>
        {% endif %}<br>
        <strong>Status:</strong> 
        {% if bill.paid %}
            <span class="badge bg-success">Paid on {{ bill.paid_date|date:"M d, Y" }}</span>
        {% else %}
            <span class="badge bg-warning text-dark">Unpaid</span>
        {% endif %}<br>
        {% if is_custom and bill.description %}
            <strong>Description:</strong> {{ bill.description }}<br>
        {% endif %}
        <strong>Contact:</strong> {{ client.contact }}<br>
        <strong>Email:</strong> {{ client.email }}<br>
        <strong>Address:</strong> {{ client.address }}<br>
        <strong>GST Number:</strong> {{ client.gst_number }}<br>

    </div>
    <table class="table table-bordered w-50">
        <tr>
            <th>Bottles Delivered</th>
            <td>{{ delivered }}</td>
        </tr>
        <tr>
            <th>Price per Bottle</th>
            <td>₹{{ price }}</td>
        </tr>
        <tr>
            <th>Subtotal</th>
            <td>₹{{ bill.subtotal_amount|default:total|floatformat:2 }}</td>
        </tr>

        {% if bill.discount_percentage and bill.discount_percentage|floatformat:2 != '0.00' %}
        <tr>
            <th>Discount</th>
            <td>{{ bill.discount_percentage }}% (₹{{ bill.discount_amount|floatformat:2 }})</td>
        </tr>
        {% endif %}

        <tr>
            <th>Taxable Value</th>
            <td>₹{{ bill.taxable_amount|default:total|floatformat:2 }}</td>
        </tr>
        <tr>
            <th>GST</th>
            <td>{{ bill.gst_percentage|default:"18" }}% (₹{{ bill.gst_amount|floatformat:2 }})</td>
        </tr>
        <tr class="table-success">
            <th>Final Payable</th>
            <td><strong>₹{{ bill.final_amount|default:total|floatformat:2 }}</strong></td>
        </tr>
    </table>
        <!-- Payment Details -->
        {% if admin_client %}
        <div class="card mt-4 shadow-sm w-75">
            <div class="card-header bg-secondary text-white text-center">
                <strong>Payment Details</strong>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- Bank Details -->
                    <div class="col-md-6 border-end">
                        <h6 class="text-primary mb-2">Bank Transfer</h6>
                        <p class="mb-1"><strong>Account Holder:</strong> {{ admin_client.account_holder }}</p>
                        <p class="mb-1"><strong>Account No:</strong> {{ admin_client.account_number }}</p>
                        <p class="mb-1"><strong>IFSC:</strong> {{ admin_client.ifsc }}</p>
                        <p class="mb-1"><strong>Branch:</strong> {{ admin_client.branch }}</p>
                        <p class="mb-1"><strong>Type:</strong> {{ admin_client.account_type }}</p>
                    </div>

                    <!-- UPI Details -->
                    <div class="col-md-6 text-center">
                        <h6 class="text-success mb-2">UPI Payment</h6>
                        {% if admin_client.vpa %}
                            <p class="mb-1"><strong>VPA:</strong> {{ admin_client.vpa }}</p>
                        {% endif %}
                        {% if admin_client.upi_number %}
                            <p class="mb-1"><strong>UPI No:</strong> {{ admin_client.upi_number }}</p>
                        {% endif %}
                        {% if admin_client.upi_qr %}
                            <div class="mt-2">
                                <img src="{{ admin_client.upi_qr.url }}" alt="UPI QR" class="img-thumbnail" width="120">
                                <p class="small text-muted">Scan & Pay</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

    <div class="mt-3">
        <a href="{% url 'generate_bill' client.id bill.id %}?format=pdf" class="btn btn-danger">Export PDF</a>
        <button class="btn btn-primary" onclick="window.print()">Print Bill</button>
        <a href="{% url 'bill_history' client.id %}" class="btn btn-info">View Bill History</a>
        <a href="{% url 'client_list' %}" class="btn btn-secondary">Back to Clients</a>
    </div>
{% endblock%}