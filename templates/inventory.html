{% extends "base.html" %}
{% load widget_tweaks %}
{% block title %}Bottle Inventory{% endblock %}

{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Bottle Inventory</h2>
        {% if request.user.username == 'admin' %}
        <a href="{% url 'add_bottles' %}" class="btn btn-primary">Add Bottles to Inventory</a>
        {% endif %}
    </div>
    {% if messages %}
    <div class="mb-3">
        {% for message in messages %}
        <div class="alert alert-success">{{ message }}</div>
        {% endfor %}
    </div>
    {% endif %}
    <div class="row text-center mb-4">
        <div class="col-md-3 col-6">
            <div class="card bg-light mb-3">
                <div class="card-body">
                    <h5 class="card-title">Total Bottles</h5>
                    <p class="card-text display-6">{{ total }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-6">
            <div class="card bg-success text-white mb-3">
                <div class="card-body">
                    <h5 class="card-title">In Stock</h5>
                    <p class="card-text display-6">{{ in_stock }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-6">
            <div class="card bg-info text-white mb-3">
                <div class="card-body">
                    <h5 class="card-title">Delivered</h5>
                    <p class="card-text display-6">{{ delivered }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 col-6">
            <div class="card bg-warning text-dark mb-3">
                <div class="card-body">
                    <h5 class="card-title">Returned</h5>
                    <p class="card-text display-6">{{ returned }}</p>
                </div>
            </div>
        </div>
    </div>
    <form method="get" class="row g-3 mb-3">
        <div class="col-auto">
            <input type="text" name="q" class="form-control" placeholder="Search by code (e.g. SV-101)" value="{{ code_query }}">
        </div>
        <div class="col-auto">
            <select name="status" class="form-select">
                <option value="">All Statuses</option>
                <option value="in_stock" {% if status == 'in_stock' %}selected{% endif %}>In Stock</option>
                <option value="delivered" {% if status == 'delivered' %}selected{% endif %}>Delivered</option>
                <option value="returned" {% if status == 'returned' %}selected{% endif %}>Returned</option>
            </select>
        </div>
        <div class="col-auto">
            <select name="category" class="form-select">
                <option value="">All Categories</option>
                {% for category in categories %}
                    <option value="{{ category.id }}" {% if selected_category == category.id|stringformat:"s" %}selected{% endif %}>
                        {{ category.name }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-auto">
            <button type="submit" class="btn btn-primary">Filter/Search</button>
        </div>
    </form>
    <h4>All Bottles</h4>
    <table class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>Code</th>
                <th>Status</th>
                <th>Category</th>
                {% comment %} {% if request.user.username == 'admin' %}<th>Photos</th>{% endif %} {% endcomment %}
            </tr>
        </thead>
        <tbody>
            {% for bottle in bottles %}
            <tr>
                <td>{{ bottle.code }}</td>
                <td>
                    {% if bottle.status == 'in_stock' %}
                        <span class="badge bg-success">In Stock</span>
                    {% elif bottle.status == 'delivered' %}
                        <span class="badge bg-primary">Delivered</span>
                    {% elif bottle.status == 'returned' %}
                        <span class="badge bg-info text-dark">Returned</span>
                    {% endif %}
                </td>
                <td>{{ bottle.category.name }}</td>
                {% comment %} {% if request.user.username == 'admin' %}
                <td><a href="{% url 'bottle_photos' bottle.code %}" class="btn btn-sm btn-outline-info">View Photos</a></td>
                {% endif %} {% endcomment %}
            </tr>
            {% empty %}
            <tr>
                <td colspan="2" class="text-center">No bottles found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %} 